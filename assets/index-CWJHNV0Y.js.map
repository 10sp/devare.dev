{"version":3,"file":"index-CWJHNV0Y.js","sources":["../../node_modules/react-intersection-observer-hook/dist/index.mjs","../../node_modules/react-infinite-scroll-hook/dist/index.mjs","../../src/features/feed/components/Feed.tsx"],"sourcesContent":["// src/use-intersection-observer.ts\nimport { useCallback, useRef, useState } from \"react\";\n\n// src/utils.ts\nfunction createObserverCache() {\n  const cachesByRoot = /* @__PURE__ */ new Map();\n  function getObserver({\n    root,\n    rootMargin,\n    threshold\n  }) {\n    let cacheByRoot = cachesByRoot.get(root);\n    if (!cacheByRoot) {\n      cacheByRoot = /* @__PURE__ */ new Map();\n      cachesByRoot.set(root, cacheByRoot);\n    }\n    const cacheKey = JSON.stringify({ rootMargin, threshold });\n    let cachedObserver = cacheByRoot.get(cacheKey);\n    if (!cachedObserver) {\n      const entryCallbacks = /* @__PURE__ */ new Map();\n      const observer = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            const callback = entryCallbacks.get(entry.target);\n            callback?.(entry);\n          });\n        },\n        { root, rootMargin, threshold }\n      );\n      cachedObserver = { observer, entryCallbacks };\n      cacheByRoot.set(cacheKey, cachedObserver);\n    }\n    return {\n      observe: (node, callback) => {\n        cachedObserver.entryCallbacks.set(node, callback);\n        cachedObserver.observer.observe(node);\n      },\n      unobserve: (node) => {\n        cachedObserver.entryCallbacks.delete(node);\n        cachedObserver.observer.unobserve(node);\n      }\n    };\n  }\n  return { getObserver };\n}\n\n// src/use-intersection-observer.ts\nvar DEFAULT_ROOT_MARGIN = \"0px\";\nvar DEFAULT_THRESHOLD = [0];\nvar observerCache = createObserverCache();\nfunction useIntersectionObserver(args) {\n  const rootMargin = args?.rootMargin ?? DEFAULT_ROOT_MARGIN;\n  const threshold = args?.threshold ?? DEFAULT_THRESHOLD;\n  const nodeRef = useRef(null);\n  const rootRef = useRef(null);\n  const observerRef = useRef(null);\n  const [entry, setEntry] = useState();\n  const reinitializeObserver = useCallback(() => {\n    function cleanupObserver() {\n      const observer = observerRef.current;\n      const node = nodeRef.current;\n      if (node) {\n        observer?.unobserve(node);\n        setEntry(void 0);\n      }\n      observerRef.current = null;\n    }\n    function initializeObserver() {\n      const node = nodeRef.current;\n      if (!node) return;\n      const observer = observerCache.getObserver({\n        root: rootRef.current,\n        rootMargin,\n        threshold\n      });\n      observer.observe(node, (observedEntry) => {\n        setEntry(observedEntry);\n      });\n      observerRef.current = observer;\n    }\n    cleanupObserver();\n    initializeObserver();\n  }, [rootMargin, threshold]);\n  const refCallback = useCallback(\n    (node) => {\n      nodeRef.current = node;\n      reinitializeObserver();\n      return () => {\n        nodeRef.current = null;\n        reinitializeObserver();\n      };\n    },\n    [reinitializeObserver]\n  );\n  const rootRefCallback = useCallback(\n    (rootNode) => {\n      rootRef.current = rootNode;\n      reinitializeObserver();\n      return () => {\n        rootRef.current = null;\n        reinitializeObserver();\n      };\n    },\n    [reinitializeObserver]\n  );\n  return [refCallback, { entry, rootRef: rootRefCallback }];\n}\nvar use_intersection_observer_default = useIntersectionObserver;\n\n// src/use-track-visibility.ts\nimport { useState as useState2 } from \"react\";\nfunction useTrackVisibility(args) {\n  const { once, ...rest } = args ?? {};\n  const [ref, result] = use_intersection_observer_default(rest);\n  const isVisible = Boolean(result.entry?.isIntersecting);\n  const [isVisibleOnce, setIsVisibleOnce] = useState2(isVisible);\n  if (once && isVisible && !isVisibleOnce) {\n    setIsVisibleOnce(true);\n  }\n  return [ref, { ...result, isVisible: once ? isVisibleOnce : isVisible }];\n}\nvar use_track_visibility_default = useTrackVisibility;\nexport {\n  use_intersection_observer_default as useIntersectionObserver,\n  use_track_visibility_default as useTrackVisibility\n};\n","// src/use-infinite-scroll.ts\nimport { useEffect, useRef } from \"react\";\nimport {\n  useTrackVisibility\n} from \"react-intersection-observer-hook\";\nvar DEFAULT_DELAY_IN_MS = 100;\nfunction useInfiniteScroll({\n  loading,\n  hasNextPage,\n  onLoadMore,\n  rootMargin,\n  disabled,\n  delayInMs = DEFAULT_DELAY_IN_MS\n}) {\n  const savedCallbackRef = useRef(onLoadMore);\n  const [ref, { rootRef, isVisible }] = useTrackVisibility({\n    rootMargin\n  });\n  useEffect(() => {\n    savedCallbackRef.current = onLoadMore;\n  }, [onLoadMore]);\n  const shouldLoadMore = !disabled && !loading && isVisible && hasNextPage;\n  useEffect(() => {\n    if (shouldLoadMore) {\n      const timer = setTimeout(() => {\n        savedCallbackRef.current();\n      }, delayInMs);\n      return () => {\n        clearTimeout(timer);\n      };\n    }\n  }, [shouldLoadMore, delayInMs]);\n  return [ref, { rootRef }];\n}\nvar use_infinite_scroll_default = useInfiniteScroll;\nexport {\n  use_infinite_scroll_default as default\n};\n","import useInfiniteScroll from 'react-infinite-scroll-hook'\r\nimport { PropagateLoader } from 'react-spinners'\r\nimport { useGetFeed } from 'src/features/cards'\r\nimport { trackFeedScroll } from 'src/lib/analytics'\r\nimport { useUserPreferences } from 'src/stores/preferences'\r\nimport { FeedItemData } from 'src/types'\r\nimport './feed.css'\r\nimport { FeedItem } from './feedItems/FeedItem'\r\n\r\nexport const Feed = () => {\r\n  const { userSelectedTags } = useUserPreferences()\r\n  const {\r\n    data: feed,\r\n    isLoading,\r\n    isInitialLoading,\r\n    hasNextPage,\r\n    isError,\r\n    error,\r\n    isFetchingNextPage,\r\n    fetchNextPage,\r\n  } = useGetFeed({\r\n    tags: userSelectedTags.map((tag) => tag.label.toLocaleLowerCase()),\r\n    config: {\r\n      select: (data) => {\r\n        return {\r\n          ...data,\r\n          pages: data.pages.map((page, pageIndex) => {\r\n            const items = page.data\r\n            const result: FeedItemData[] = []\r\n            items.forEach((item, index) => {\r\n              result.push(item)\r\n            })\r\n\r\n            return {\r\n              ...page,\r\n              data: result,\r\n            }\r\n          }),\r\n        }\r\n      },\r\n    },\r\n  })\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading: isLoading,\r\n    hasNextPage: Boolean(hasNextPage),\r\n    onLoadMore: () => {\r\n      fetchNextPage()\r\n      trackFeedScroll()\r\n    },\r\n    disabled: Boolean(error),\r\n    rootMargin: '0px 0px 100% 0px',\r\n  })\r\n\r\n  if (isInitialLoading) {\r\n    return (\r\n      <div className=\"feed\">\r\n        {Array.from({\r\n          length: 10,\r\n        }).map((_, index) => (\r\n          <div className=\"feedItem placeholder\" key={`loading-${index}`}>\r\n            <div className=\"image\"></div>\r\n            <div className=\"line\"></div>\r\n            <div className=\"smallLine\"></div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div ref={rootRef} className=\"feed scrollable\" style={{ overflow: 'auto', maxHeight: '100%' }}>\r\n      {(feed?.pages.flatMap((page) => page.data) || []).map((article, index) => {\r\n        return (\r\n          <FeedItem\r\n            item={article}\r\n            key={article.id}\r\n            index={index}\r\n            analyticsTag={'feed'}\r\n            className=\"feedItem\"\r\n          />\r\n        )\r\n      })}\r\n      {hasNextPage && (\r\n        <div className=\"feedLoading\" ref={infiniteRef}>\r\n          <PropagateLoader color={'#A9B2BD'} loading={true} size={8} />\r\n        </div>\r\n      )}\r\n      {isFetchingNextPage && isError && <div>Error while loading more pages</div>}\r\n    </div>\r\n  )\r\n}\r\n"],"names":["createObserverCache","cachesByRoot","getObserver","root","rootMargin","threshold","cacheByRoot","cacheKey","cachedObserver","entryCallbacks","entries","entry","callback","node","DEFAULT_ROOT_MARGIN","DEFAULT_THRESHOLD","observerCache","useIntersectionObserver","args","nodeRef","useRef","rootRef","observerRef","setEntry","useState","reinitializeObserver","useCallback","cleanupObserver","observer","initializeObserver","observedEntry","refCallback","rootRefCallback","rootNode","use_intersection_observer_default","useTrackVisibility","once","rest","ref","result","isVisible","_a","isVisibleOnce","setIsVisibleOnce","useState2","use_track_visibility_default","DEFAULT_DELAY_IN_MS","useInfiniteScroll","loading","hasNextPage","onLoadMore","disabled","delayInMs","savedCallbackRef","useEffect","shouldLoadMore","timer","use_infinite_scroll_default","Feed","userSelectedTags","useUserPreferences","feed","isLoading","isInitialLoading","isError","error","isFetchingNextPage","fetchNextPage","useGetFeed","tag","data","page","pageIndex","items","item","index","infiniteRef","trackFeedScroll","jsx","_","jsxs","article","FeedItem","PropagateLoader"],"mappings":"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","x_google_ignoreList":[0,1]}