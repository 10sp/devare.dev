import{u as h,au as R,aM as N,aN as O,aO as _}from"./index-7MWe1d52.js";import{r as f,k as d}from"./core-BQ9oUMX2.js";import"./utils-ZVqEcU1h.js";import"./ui-BLpkT4OS.js";function E(){const n=new Map;function c({root:o,rootMargin:i,threshold:a}){let t=n.get(o);t||(t=new Map,n.set(o,t));const l=JSON.stringify({rootMargin:i,threshold:a});let s=t.get(l);if(!s){const e=new Map;s={observer:new IntersectionObserver(b=>{b.forEach(r=>{const u=e.get(r.target);u==null||u(r)})},{root:o,rootMargin:i,threshold:a}),entryCallbacks:e},t.set(l,s)}return{observe:(e,v)=>{s.entryCallbacks.set(e,v),s.observer.observe(e)},unobserve:e=>{s.entryCallbacks.delete(e),s.observer.unobserve(e)}}}return{getObserver:c}}var y="0px",k=[0],C=E();function L(n){const c=(n==null?void 0:n.rootMargin)??y,o=(n==null?void 0:n.threshold)??k,i=f.useRef(null),a=f.useRef(null),t=f.useRef(null),[l,s]=f.useState(),e=f.useCallback(()=>{function r(){const m=t.current,p=i.current;p&&(m==null||m.unobserve(p),s(void 0)),t.current=null}function u(){const m=i.current;if(!m)return;const p=C.getObserver({root:a.current,rootMargin:c,threshold:o});p.observe(m,x=>{s(x)}),t.current=p}r(),u()},[c,o]),v=f.useCallback(r=>(i.current=r,e(),()=>{i.current=null,e()}),[e]),b=f.useCallback(r=>(a.current=r,e(),()=>{a.current=null,e()}),[e]);return[v,{entry:l,rootRef:b}]}var j=L;function I(n){var e;const{once:c,...o}=n??{},[i,a]=j(o),t=!!((e=a.entry)!=null&&e.isIntersecting),[l,s]=f.useState(t);return c&&t&&!l&&s(!0),[i,{...a,isVisible:c?l:t}]}var T=I,S=100;function F({loading:n,hasNextPage:c,onLoadMore:o,rootMargin:i,disabled:a,delayInMs:t=S}){const l=f.useRef(o),[s,{rootRef:e,isVisible:v}]=T({rootMargin:i});f.useEffect(()=>{l.current=o},[o]);const b=!a&&!n&&v&&c;return f.useEffect(()=>{if(b){const r=setTimeout(()=>{l.current()},t);return()=>{clearTimeout(r)}}},[b,t]),[s,{rootRef:e}]}var M=F;const V=()=>{const{userSelectedTags:n}=h(),{data:c,isLoading:o,isInitialLoading:i,hasNextPage:a,isError:t,error:l,isFetchingNextPage:s,fetchNextPage:e}=R({tags:n.map(r=>r.label.toLocaleLowerCase()),config:{select:r=>({...r,pages:r.pages.map((u,m)=>{const p=u.data,x=[];return p.forEach((g,w)=>{x.push(g)}),{...u,data:x}})})}}),[v,{rootRef:b}]=M({loading:o,hasNextPage:!!a,onLoadMore:()=>{e(),_()},disabled:!!l,rootMargin:"0px 0px 100% 0px"});return i?d.jsx("div",{className:"feed",children:Array.from({length:10}).map((r,u)=>d.jsxs("div",{className:"feedItem placeholder",children:[d.jsx("div",{className:"image"}),d.jsx("div",{className:"line"}),d.jsx("div",{className:"smallLine"})]},`loading-${u}`))}):d.jsxs("div",{ref:b,className:"feed scrollable",style:{overflow:"auto",maxHeight:"100%"},children:[((c==null?void 0:c.pages.flatMap(r=>r.data))||[]).map((r,u)=>d.jsx(N,{item:r,index:u,analyticsTag:"feed",className:"feedItem"},r.id)),a&&d.jsx("div",{className:"feedLoading",ref:v,children:d.jsx(O.PropagateLoader,{color:"#A9B2BD",loading:!0,size:8})}),s&&t&&d.jsx("div",{children:"Error while loading more pages"})]})};export{V as Feed,N as FeedItem,R as useGetFeed};
//# sourceMappingURL=index-CWJHNV0Y.js.map
